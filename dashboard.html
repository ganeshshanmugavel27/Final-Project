{% extends "base.html" %}
{% block title %}Dashboard â€“ SportsLink{% endblock %}

{% block content %}
<div class="page-header">
  <h1>Welcome, {{ current_user.username }} ğŸ‘‹</h1>
  <span class="badge badge-{{ current_user.role }}">{{ current_user.role | capitalize }}</span>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PLAYER DASHBOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
{% if current_user.role == 'player' %}

  {% if profile %}
    <div class="dashboard-grid">
      <div class="card profile-summary">
        <h3>Your Profile</h3>
        <p><strong>Sport:</strong> {{ profile.sport }}</p>
        <p><strong>Position:</strong> {{ profile.position }}</p>
        <p><strong>Experience:</strong> {{ profile.experience_years }} year(s)</p>
        <p><strong>Location:</strong> {{ profile.location or 'Not set' }}</p>
        <div class="skills-row">
          {% for skill in profile.skills_list() %}
            <span class="skill-tag">{{ skill }}</span>
          {% endfor %}
        </div>
        <a href="{{ url_for('player_profile') }}" class="btn btn-outline btn-sm" style="margin-top:12px">Edit Profile</a>
      </div>

      <div class="card">
        <h3>Recent Team Openings</h3>
        {% if requirements %}
          <ul class="req-list">
            {% for req in requirements %}
              <li>
                <a href="{{ url_for('view_requirement', req_id=req.id) }}">{{ req.team_name }} â€“ {{ req.position }} ({{ req.sport }})</a>
                {% if req.id in interested_ids %}
                  <span class="badge-interested">âœ… Interested</span>
                {% endif %}
                <small>{{ req.location }}</small>
              </li>
            {% endfor %}
          </ul>
          <a href="{{ url_for('view_requirements') }}" class="btn btn-outline btn-sm">Browse All Openings</a>
        {% else %}
          <p class="empty-state">No openings posted yet.</p>
        {% endif %}
      </div>
    </div>

  {% else %}
    <div class="card empty-card">
      <div class="empty-icon">ğŸ“</div>
      <h3>Set Up Your Player Profile</h3>
      <p>Create your profile so teams can find and match with you.</p>
      <a href="{{ url_for('player_profile') }}" class="btn btn-primary">Create Profile</a>
    </div>
  {% endif %}

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TEAM DASHBOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
{% else %}

  <div class="dashboard-actions">
    <a href="{{ url_for('post_requirement') }}" class="btn btn-primary">+ Post New Opening</a>
    <a href="{{ url_for('view_players') }}" class="btn btn-outline">Browse Players</a>
  </div>

  {% if requirements %}

    {% for req in requirements %}
    <div class="card team-req-block" style="margin-top:24px">

      <!-- â”€â”€ Requirement Header â”€â”€ -->
      <div class="team-req-header">
        <div>
          <h3>{{ req.team_name }} â€” <span class="position-badge">{{ req.position }}</span></h3>
          <div class="player-meta" style="margin-top:6px">
            <span>ğŸ… {{ req.sport }}</span>
            <span>ğŸ“… {{ req.min_experience }}+ yr(s)</span>
            {% if req.location %}<span>ğŸ“ {{ req.location }}</span>{% endif %}
            <span>ğŸ™‹ {{ req.interests|length }} interested</span>
          </div>
        </div>
        <div class="team-req-actions">
          <a href="{{ url_for('view_requirement', req_id=req.id) }}" class="btn btn-sm btn-outline">View Matches</a>
          <form method="POST" action="{{ url_for('delete_requirement', req_id=req.id) }}"
                style="display:inline" onsubmit="return confirm('Delete this requirement?')">
            <button type="submit" class="btn btn-sm btn-danger">Delete</button>
          </form>
        </div>
      </div>

      <!-- â”€â”€ Interested Players Section â”€â”€ -->
      <div class="interested-section">
        <h4 class="interested-title">
          ğŸ‘¥ Interested Players
          <span class="interested-count-badge">{{ req.interests|length }}</span>
        </h4>

        {% if req.interests %}
          <div class="interested-cards">
            {% for interest in req.interests %}
              {% set player = interest.player %}
              {% set pprofile = player.player_profile %}
              <div class="interested-card">

                <!-- Avatar -->
                <div class="interested-avatar">{{ player.username[0].upper() }}</div>

                <!-- Info -->
                <div class="interested-info">
                  <strong>{{ player.username }}</strong>
                  {% if pprofile %}
                    <div class="interested-meta">
                      <span>ğŸ… {{ pprofile.sport }}</span>
                      <span>ğŸ“Œ {{ pprofile.position }}</span>
                      <span>ğŸ“… {{ pprofile.experience_years }} yr(s)</span>
                      {% if pprofile.location %}
                        <span>ğŸ“ {{ pprofile.location }}</span>
                      {% endif %}
                    </div>
                    <div class="skills-row" style="margin-top:6px">
                      {% for skill in pprofile.skills_list()[:4] %}
                        <span class="skill-tag">{{ skill }}</span>
                      {% endfor %}
                      {% if pprofile.skills_list()|length > 4 %}
                        <span class="skill-tag skill-more">+{{ pprofile.skills_list()|length - 4 }} more</span>
                      {% endif %}
                    </div>
                  {% else %}
                    <small class="text-muted">No profile created yet</small>
                  {% endif %}
                </div>

                <!-- Applied time + View button -->
                <div class="interested-actions">
                  <small class="interest-time">
                    Applied {{ interest.created_at.strftime('%b %d, %Y') }}
                  </small>
                  {% if pprofile %}
                    <a href="{{ url_for('player_detail', player_id=pprofile.id) }}"
                       class="btn btn-sm btn-primary">View Profile</a>
                  {% endif %}
                </div>

              </div>
            {% endfor %}
          </div>

        {% else %}
          <div class="no-interest">
            <span>ğŸ”</span>
            <p>No players have expressed interest yet. Share your opening to attract players!</p>
          </div>
        {% endif %}
      </div>

    </div>
    {% endfor %}

  {% else %}
    <div class="card empty-card" style="margin-top:24px">
      <div class="empty-icon">ğŸ“‹</div>
      <h3>No Openings Posted Yet</h3>
      <p>Post your first opening to start finding players.</p>
      <a href="{{ url_for('post_requirement') }}" class="btn btn-primary">Post First Opening</a>
    </div>
  {% endif %}

{% endif %}
{% endblock %}